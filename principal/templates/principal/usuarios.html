<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GestiÃ³n de Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
    <div class="container bg-white p-4 rounded shadow" style="max-width: 900px;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-dark fw-bold">ðŸ›¡ GESTIÃ“N DE USUARIOS (RRHH)</h3>
            <a href="{% url 'menu' %}" class="btn btn-secondary">â¬… Volver al MenÃº</a>
        </div>

        <div class="card mb-4 p-4 shadow-sm border-0 bg-light">
            <h5 class="mb-3">Registrar Nuevo Personal</h5>
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Usuario (Login)</label>
                    <input type="text" id="username" class="form-control" placeholder="ej: cajero1">
                </div>
                <div class="col-md-3">
                    <label class="form-label">ContraseÃ±a</label>
                    <input type="password" id="password" class="form-control" placeholder="******">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Nombre Real</label>
                    <input type="text" id="nombre" class="form-control" placeholder="Juan Perez">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Rol / Permisos</label>
                    <select id="rol" class="form-select">
                        <option value="COLABORADOR">Colaborador (Ventas)</option>
                        <option value="TEMPORAL">Temporal (Limitado)</option>
                        <option value="ADMIN">ADMINISTRADOR (Total)</option>
                    </select>
                </div>
                <div class="col-12 text-end">
                    <button class="btn btn-dark" onclick="crearUsuario()">âž• Crear Usuario</button>
                </div>
            </div>
        </div>

        <table class="table align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Rol</th>
                    <th>AcciÃ³n</th>
                </tr>
            </thead>
            <tbody>
                {% for u in usuarios %}
                <tr>
                    <td class="fw-bold">{{ u.username }}</td>
                    <td>{{ u.first_name }}</td>
                    <td>
                        {% if u.is_superuser %}
                            <span class="badge bg-danger">ADMIN</span>
                        {% else %}
                            <span class="badge bg-primary">COLABORADOR</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.id != u.id %}
                        <button class="btn btn-sm btn-outline-danger" onclick="eliminar({{ u.id }})">Eliminar</button>
                        {% else %}
                        <small class="text-muted">(TÃº)</small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function crearUsuario() {
            let data = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                nombre: document.getElementById('nombre').value,
                rol: document.getElementById('rol').value
            };
            if(!data.username || !data.password) return alert("Faltan datos");

            fetch('/guardar_usuario/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
                body: JSON.stringify(data)
            }).then(r => r.json()).then(d => {
                if(d.status === 'ok') { alert("Usuario Creado"); location.reload(); }
                else alert(d.mensaje);
            });
        }

        function eliminar(id) {
            if(confirm("Â¿Seguro que deseas eliminar este usuario? No podrÃ¡ entrar mÃ¡s al sistema.")) {
                fetch('/eliminar_usuario/'+id+'/', { method: 'GET' })
                .then(r => r.json()).then(d => {
                    if(d.status === 'ok') location.reload();
                    else alert(d.mensaje);
                });
            }
        }
    </script>
</body>
</html>